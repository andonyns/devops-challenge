apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: loki
  namespace: {{ .Release.Namespace }}
spec:
  chart:
    repository: https://grafana.github.io/helm-charts
    name: loki
    version: "5.10.0" # Specify the desired version of the Loki chart
  values:
    persistence:
      enabled: true
      size: 10Gi
    config:
      schema_config:
        configs:
          - from: "2020-10-24"
            store: boltdb-shipper
            object_store: filesystem
            schema: v11
            index:
              prefix: index_
              period: 168h
      storage_config:
        boltdb_shipper:
          active_index_directory: /data/loki/boltdb-shipper-active
          cache_location: /data/loki/boltdb-shipper-cache
          shared_store: filesystem
        filesystem:
          directory: /data/loki/chunks
    extraVolumes:
      - name: data
        emptyDir: {}
    extraVolumeMounts:
      - name: data
        mountPath: /data